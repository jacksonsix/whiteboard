<html>
  <head>

    <script src="goal.js"></script>

    <script src="element.js"></script>
    <style>
	canvas {
	    height: 100px;
	    width: 100px;
	    border: 1px solid blue;
	} 

    </style>
  </head>
  <body>
<span>upload file</span>
<form action="fileupload" method="post" enctype="multipart/form-data">
	<input type="file" id="uploadinput" name="filetoupload">
	
</form>   
<div><input type="submit" value="Send file" onclick="sendFiles()"></div> 
<p>another pic list here</p>

<input type="file" id="fileElem" multiple accept="image/*" style="display:none">
<a href="#" id="fileSelect">Select some files</a> 
<div id="fileList">
  <p>No files selected!</p>
</div>
 <div>
        <div id="dropzone" style="margin:30px; width:500px; height:300px; border:1px dotted grey;">Drag & drop your file</div>
    </div>
<span>note</span>
    
   <div>
      <input type='file' name='img' size='65' id='uploadimage' />
    </div>

    <div id="btn">
      <input id="btn1" type="text" id="txtState"></input>
      <span>test word</span>
    </div>
    <div id="holder"> 
    </div>
    <script src="image.js"></script>
    <script>
      //upload picture and draw
      

      //let dbconnect =  initdb()();
      //document.getElementById("uploadinput").addEventListener("change", sendToserver,false);

      document.getElementById("uploadimage").addEventListener("change", function() {
      
      let can =  createElement("holder","canvas");
      //set active in state
      // let stat = getInstance();
      // stat['setCurObj'](can.id);
      //save object to store
      //dbconnect["add"](can.id,can.id);
      //draw UI
      draw(can.id);
      
      }, false)

    </script>
   
    <script>
      
      let status = 'default';
      let cursorStyle ='default';
      let canavsId ='holder';
      document.addEventListener("mousemove", evt => {
      let e = evt || window.event;
      //console.log(e.clientX);
      // console.log(e.pageX);
      // cursor style
      let obj = document.getElementById(canavsId);
     
      let curRect = obj.getBoundingClientRect();
      let sty = checkEdge(e.clientX,e.clientY,curRect);
      // more cursor images;
      
      obj.style.cursor= sty;
      if(sty ==='clock-rotate'){
        obj.style.cursor = "url('pic/rotate.png'),auto";
      }
      cursorStyle = sty;
      if(sty ==='move'
       || sty==='e-resize'
       || sty ==='s-resize'
       || sty ==='se-resize'
       || sty ==='clock-rotate'){
        obj.style['border-style'] ='dotted';
      }else{
        obj.style['border-style'] = 'none';
      }
      // object action
      if(status==='move'){
          moveObject(canavsId,e.clientX,e.clientY);
      }else if(status==='e-resize'){
          eresizeObject(canavsId,e.clientX,obj.offsetWidth);
      }else if(status==='se-resize'){
          seresizeObject(canavsId,e.clientX,e.clientY,obj.offsetWidth,obj.offsetHeight);
      }else if(status==='s-resize'){
          sresizeObject(canavsId,e.clientY,obj.offsetHeight);
      }else if(status==='clock-rotate'){
          rotateObject(canavsId,e.clientX,e.clientY);
      }
      });


      
      // check and set status
      document.addEventListener("mousedown",function(evt){
        let obj = document.getElementById(canavsId);
        let curRect = obj.getBoundingClientRect();
        cursorStyle = checkEdge(evt.clientX,evt.clientY,curRect);
        lastX = evt.clientX;
        lastY = evt.clientY;
        if(cursorStyle==='move'){
           status = 'move';
        }else if(cursorStyle==='e-resize'){
          status ='e-resize';   
        }else if(cursorStyle==='se-resize'){
         status ='se-resize';
        }else if(cursorStyle==='s-resize'){
         status ='s-resize';
        }else if(cursorStyle==='clock-rotate'){
         status ='clock-rotate';
        }
        else{
         status ='default';
        }
        //status = cursorStyle;
        console.log('mouse down event');
      });

      document.addEventListener("mouseup",function(evt){
         status ='default';
         console.log('up event');
      });

 
     
    
			       
    </script>

    <script>
        function sendFile(file) {
            const uri = "http://localhost:9081/fileupload/98";
            const xhr = new XMLHttpRequest();
            const fd = new FormData();
            
            xhr.open("POST", uri, true);
            xhr.onreadystatechange = function() {
                if (xhr.readyState == 4 && xhr.status == 200) {
                    //alert(xhr.responseText); // handle response.
		    console.log('upload success');
                }
            };
            fd.append('myFile', file);
            // Initiate a multipart/form-data upload
            xhr.send(fd);
        }

 	window.onload = function() {
            const dropzone = document.getElementById("dropzone");
            dropzone.ondragover = dropzone.ondragenter = function(event) {
                event.stopPropagation();
                event.preventDefault();
            }
    
            dropzone.ondrop = function(event) {
                event.stopPropagation();
                event.preventDefault();

                const filesArray = event.dataTransfer.files;
                for (let i=0; i<filesArray.length; i++) {
                    sendFile(filesArray[i]);
                }
            }
        }
    </script>

  </body>

</html>
